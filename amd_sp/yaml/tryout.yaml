# QEMU configuration
qemu:
  # Zen generation to emulate
  zen: "Zen2"
  # On-chip bootloader to use
  on_chip_bl_path: "bins/on-chip-bl-Ryzen-Zen2-Desktop"
# Flash informations
flash:
  # Size of flash memory
  size: 0x1000000
  # Base image in flash memory
  base: "bins/PRIME-X370-PRO-ASUS-6203.ROM"

debug: true
input:
  flash:
    # No initial content
  psp:
    input:
      # Mailbox and Pointer
      - addr: 0x03010570
        size: 0xc
  fixed:
    # Setting up fixed addr doesn't work when using off-chip


# Harness
harness:
  # cold_boot call to x86_workloop #
  # start: 0x116c
  # Start from on-chip-bl and see how far we get
  start: 0xffff0000
  sinks:
    # sts_report_to_x86_hang_on_error in loop
    - 0x7274
    # exited workloop
    - 0x93f0
    # wait_for_irq_or_work waiting for interrupt
    - 0x0210
    # Starting SecOS
    - 0xD2EE


# Tunnels describe any fixup that has to happen during execution
# at a certain address
tunnels:
  # fix function in x86_workloop
  - addr: 0x9236
    action: SetConstant
    target: R0
    value: 0x0
  # overwrite of 0x100ac
  - addr: 0x6988
    action: SetConstant
    target: R0
    value: 0x1
  # SKIP ABL
  - addr: 0x2938 # When the overwriting happens
    action: Jump
    source: 0x2a1c # what gets overwritten
    target: 0x2a2a # where to jump to
  # Message has been sent
  - addr:   0x9408
    action: WriteMemory
    target: 0x108ae
    value: [0x1]

  ### Jump To SecOS stuff
  # Log error code of load_app_id_from_flash
  - addr: 0xd26e
    action: LogRegister
    target: R0
  # Debug error state
  - addr: 0xa9a4
    action: LogRegister
    target: LR
  - addr: 0x7246
    action: LogRegister
    target: R0

crashes:
  # Breakpoints as crashes
  breakpoints:
  mmap:
    no_exec:
    # TODO: figure out relevant regions
    ccp_memcopy_addr: 0x0
    forbidden_memcopies:
    forbidden_writes:

# Snapshotting behaviour:
# - Use enum for "default", "on_crash", "periodically":
#   ["SuperLazy", "Lazy", "RustSnapshot", "HardReset"]
# - "period":
#   number of testcases before running state_rest "periodically"
snapshot:
  default: "SuperLazy"
  on_crash: "HardReset"
  periodically: "RustSnapshot"
  period: 100000
